(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{1198:function(e,t,a){"use strict";a.r(t),a.d(t,"COUNTER_ADD_NEW_ROW",(function(){return S})),a.d(t,"COUNTER_ADD_CUSTOM_FORM_FIELDS",(function(){return A})),a.d(t,"COUNTER_MODIFY_EXPECTED_DRAWER_AMOUNT",(function(){return x})),a.d(t,"DRAWER_DIFFERENCE_TEXT_CHANGES",(function(){return N})),a.d(t,"DRAWER_DIFFERENCE_AMOUNT_CHANGES",(function(){return C})),a.d(t,"COUNTER_FILTER_ORDER_CUSTOM_FIELD_BASED",(function(){return k})),a.d(t,"SHOW_DRAWER_DETAILS_FILTER",(function(){return T}));var r=a(14),n=a.n(r),c=a(15),l=a.n(c),o=a(10),s=a.n(o),i=a(16),u=a.n(i),d=a(17),p=a.n(d),_=a(9),m=a.n(_),b=a(0),f=a(5),O=a.n(f),E=a(22),y=a(20),w=a(62),h=a(7),j=a(12),F=a(6),v=a(3),D=a(4),g=a(29);function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,r=m()(e);if(t){var n=m()(this).constructor;a=Reflect.construct(r,arguments,n)}else a=r.apply(this,arguments);return p()(this,a)}}var S="wkwcpos_counter_add_row",A="wkwcpos_counter_add_custom_form_fields",x="wkwcpos_counter_modify_expected_drawer_amount",N="wkwcpos_drawer_difference_text_changes",C="wkwcpos_drawer_difference_amount_changes",k="wkwcpos_counter_filter_order_custom_field_based",T="wkwcpos_show_drawer_details_filter",P=function(e){u()(a,e);var t=R(a);function a(e){var r;return n()(this,a),(r=t.call(this,e)).handleSubmit=r.handleSubmit.bind(s()(r)),r.closeDrawer=r.closeDrawer.bind(s()(r)),r}return l()(a,[{key:"handleSubmit",value:function(e){var t=navigator.onLine;if(e.preventDefault(),t){var a=this.props.dispatch,r=this.props.orders,n=[];r&&r.length>0&&(n=r.filter((function(e){return"offline"==e.order_type}))),n.length<=0?this.closeDrawer(e).then((function(e){e?(jQuery(".note_quantity input, #edrawer-amt-remark, #in-hand-card").val(""),jQuery(".amount, .total_amount span").text("0"),jQuery.confirm({title:v.a.success_text,content:v.a.drawer_closed_text,autoClose:"cancelAction|3000",type:"green",escapeKey:"cancelAction",buttons:{cancelAction:{text:v.a.cancel_btn_text,btnClass:"btn-green"}}}),a(Object(w.a)([e])),a(Object(w.b)())):jQuery.confirm({title:v.a.success_text,content:v.a.drawer_closed_text,autoClose:"cancelAction|3000",type:"red",escapeKey:"cancelAction",buttons:{cancelAction:{text:v.a.cancel_btn_text,btnClass:"pos-btn-primary"}}})})):jQuery.alert("There are offline orders present, kindly sync them first!")}else jQuery.confirm({title:v.a.warning_text,content:v.a.error_offline_account,backgroundDismiss:function(){return"buttonName"},Okay:{text:v.a.okay_text,btnClass:"pos-btn-primary"}})}},{key:"closeDrawer",value:function(e){var t={drawer:jQuery("#close-drawer-form").serialize(),logged_in_user_id:apif_script.logged_in.user_id};return new Promise((function(e,a){document.querySelector("#loading-text").innerHTML=v.a.closing_drawer_text,document.querySelector("#loader").style.display="block",Object(j.POSPostRequest)(h.a.WK_CREATE_DRAWER_PERDAY_ENDPOINT,t).then((function(t){document.querySelector("#loader").style.display="none",t&&e(t.response)}))}))}},{key:"render",value:function(){var e=Array.from(this.props.orders),t=this.props.currency,a=parseFloat(0);(a=this.props.cashier.opening_amount,localStorage&&localStorage.cashdrawer)&&(a=JSON.parse(localStorage.cashdrawer).initialAmount.initialAmount);var r=apif_script.logged_in.current_date;r=new Date(Date.parse(r)).toDateString();var n=e.filter((function(e){var t=e.order_date,a=new Date(Date.parse(t)).toDateString();if(a=a.split(" ").slice(0,4).join(" "),r.trim()==a.trim())return e}));n=Object(F.applyFilters)(k,n);var c=0,l=0,o=0;n.forEach((function(e,t){var a=parseFloat(e.balance),r=e.cardPay,n=e.cashPay,s=parseFloat(e.total_refund),i=parseFloat(r)+parseFloat(n);i=i.toFixed(2),l+=parseFloat(r),c+=parseFloat(n);var u=0;parseFloat(e.cardPay)>0&&s>0&&(l-=s),parseFloat(e.cashPay)>0&&s>0&&(c-=s),parseFloat(e.cardPay)>0&&a>0&&(l-=a),parseFloat(e.cashPay)>0&&a>0&&(c-=a),parseFloat(i)>parseFloat(e.order_total)&&(u=(u=parseFloat(i)-parseFloat(e.order_total)).toFixed(2)),o+=parseFloat(u)})),c=isNaN(c)?parseFloat(0):parseFloat(c);var s=l=isNaN(l)?parseFloat(0):parseFloat(l),i=l+c,u=parseFloat(a)+l+c-o,d=u-a;s=parseFloat(u).toFixed(2),c=parseFloat(c).toFixed(2),l=parseFloat(l).toFixed(2),a=parseFloat(a).toFixed(2);var p=Object(g.a)(a,t),_=Object(g.a)(c,t),m=Object(g.a)(l,t),f=Object(g.a)(s,t);d=Object(g.a)(parseFloat(d),t);var E=v.a.close_drawer,y=v.a.difference_between_closing_and_opening_Amount,w=(v.a.closing_drawer_detail,v.a.remarks),h=(v.a.counted_drawer_amount,v.a.expected_amount_in_drawer),j=v.a.today_cash_sale,R=v.a.today_card_sale,P=v.a.opening_amount,W=v.a.drawer_amount_details,I=v.a.cash_balance,L=new Date(Date.now()).toLocaleString().split(", ")[0];return Object(b.createElement)("div",{className:"postabContainer pos-2-col",id:"pos-cashier-tab-1"},Object(b.createElement)("div",{className:"pos-close-counter"},Object(b.createElement)("div",{className:"pos-drawer-amount pos-dcalc",id:"dcalc-drawer"},Object(F.applyFilters)(T,!0)&&Object(b.createElement)(O.a.Fragment,null,Object(b.createElement)("h3",null,W),Object(b.createElement)("ul",null,Object(b.createElement)("li",null,Object(b.createElement)("label",null,P),Object(b.createElement)("h3",null,p)),Object(b.createElement)("li",null,Object(b.createElement)("label",null,j),Object(b.createElement)("h3",null,_)),Object(b.createElement)("li",null,Object(b.createElement)("label",null,R),Object(b.createElement)("h3",null,m)),Object(F.applyFilters)(S,"",D.a,t),Object(b.createElement)("li",null,Object(b.createElement)("label",null,h),Object(b.createElement)("h3",null,Object(F.applyFilters)(x,f,c,l,D.a,t))),Object(b.createElement)("li",null,Object(b.createElement)("label",null,Object(F.applyFilters)(N,y)),Object(b.createElement)("h3",{className:"drawer-diff"},Object(F.applyFilters)(C,d)))))),Object(b.createElement)("form",{method:"POST",id:"close-drawer-form",onSubmit:this.handleSubmit},Object(b.createElement)("div",{className:"pos-cdrawer-amount pos-dcalc",id:"dcalc-cdrawer"},Object(b.createElement)("h3",null,w),Object(b.createElement)("textarea",{name:"drawer_note",id:"edrawer-amt-remark",placeholder:I}),Object(F.applyFilters)(A,"",v.a,I,t),Object(b.createElement)("input",{type:"hidden",name:"opening_balance",value:a}),Object(b.createElement)("input",{type:"hidden",name:"today_sale",value:i}),Object(b.createElement)("input",{type:"hidden",name:"total_sale",value:s}),Object(b.createElement)("input",{type:"hidden",name:"card_sale",value:l}),Object(b.createElement)("input",{type:"hidden",name:"cash_sale",value:c}),Object(b.createElement)("input",{type:"hidden",name:"date",value:L}),Object(b.createElement)("button",{type:"submit",name:"close-drawer",className:"close-drawer secondary"},E)))))}}]),a}(f.Component);t.default=Object(E.b)((function(e){return{orders:e.orders.list,cashier:e.cashier}}),(function(e){return Object.assign({dispatch:e},Object(y.bindActionCreators)({SaveSaleHistoryToDB:w.a,getSaleHistoryWC:w.b},e))}))(P)}}]);